{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.bake.sh/bake-project.schema.json",
  "title": "Bake Project Configuration",
  "description": "Schema for bake.yml project configuration files",
  "type": "object",
  "required": ["name"],
  "properties": {
    "name": {
      "type": "string",
      "description": "The name of the project",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "An optional description of the project"
    },
    "variables": {
      "type": "object",
      "description": "Global variables defined at the project level, available to all recipes. Values can be strings, numbers, booleans, arrays, or objects.",
      "additionalProperties": true
    },
    "overrides": {
      "type": "object",
      "description": "Environment-specific variable overrides (e.g., dev, prod, staging). Keys are environment names, values are variable name-value maps",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": true
      }
    },
    "environment": {
      "type": "array",
      "description": "A list of environment variables that should be sourced and made available to all recipes",
      "items": {
        "type": "string"
      }
    },
    "config": {
      "type": "object",
      "description": "The main configuration settings for the Bake tool within this project",
      "properties": {
        "maxParallel": {
          "type": "integer",
          "description": "Maximum number of recipes to run in parallel",
          "minimum": 1,
          "default": "Available CPU cores - reserved threads"
        },
        "reservedThreads": {
          "type": "integer",
          "description": "Number of threads to reserve (not use for parallel execution). Set to 0 in CI environments to use all available threads.",
          "minimum": 0,
          "default": 1
        },
        "fastFail": {
          "type": "boolean",
          "description": "Whether to stop execution on first error",
          "default": true
        },
        "verbose": {
          "type": "boolean",
          "description": "Enable verbose output",
          "default": false
        },
        "cleanEnvironment": {
          "type": "boolean",
          "description": "Whether to clean the environment before running recipes",
          "default": false
        },
        "minVersion": {
          "type": "string",
          "description": "The minimum version of bake required to work with this project configuration",
          "pattern": "^\\d+\\.\\d+\\.\\d+(-.*)?$"
        },
        "cache": {
          "type": "object",
          "description": "Cache configuration",
          "properties": {
            "local": {
              "type": "object",
              "description": "Local filesystem cache configuration",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Whether local cache is enabled",
                  "default": true
                },
                "path": {
                  "type": "string",
                  "description": "Custom path for local cache (defaults to .bake/cache)"
                },
                "compressionLevel": {
                  "type": "integer",
                  "description": "Compression level for cache archives (0-19, where 0=no compression, 1=fastest, 19=best compression). Default: 1 for local cache (optimized for speed)",
                  "minimum": 0,
                  "maximum": 19,
                  "default": 1
                }
              },
              "additionalProperties": false
            },
            "remotes": {
              "type": "object",
              "description": "Remote cache configurations",
              "properties": {
                "s3": {
                  "type": "object",
                  "description": "AWS S3 cache configuration",
                  "required": ["bucket"],
                  "properties": {
                    "bucket": {
                      "type": "string",
                      "description": "S3 bucket name for cache storage",
                      "minLength": 1
                    },
                    "region": {
                      "type": "string",
                      "description": "AWS region for the S3 bucket"
                    },
                    "compressionLevel": {
                      "type": "integer",
                      "description": "Compression level for S3 cache archives (0-19, where 0=no compression, 1=fastest, 19=best compression). Default: 3 for remote cache (balanced speed/size for network transfer)",
                      "minimum": 0,
                      "maximum": 19,
                      "default": 3
                    }
                  },
                  "additionalProperties": false
                },
                "gcs": {
                  "type": "object",
                  "description": "Google Cloud Storage cache configuration",
                  "required": ["bucket"],
                  "properties": {
                    "bucket": {
                      "type": "string",
                      "description": "GCS bucket name for cache storage",
                      "minLength": 1
                    },
                    "compressionLevel": {
                      "type": "integer",
                      "description": "Compression level for GCS cache archives (0-19, where 0=no compression, 1=fastest, 19=best compression). Default: 3 for remote cache (balanced speed/size for network transfer)",
                      "minimum": 0,
                      "maximum": 19,
                      "default": 3
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "order": {
              "type": "array",
              "description": "Order in which cache strategies should be tried",
              "items": {
                "type": "string",
                "enum": ["local", "s3", "gcs"]
              },
              "uniqueItems": true
            }
          },
          "additionalProperties": false
        },
        "update": {
          "type": "object",
          "description": "Update configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether update checking is enabled",
              "default": true
            },
            "check_interval_days": {
              "type": "integer",
              "description": "How often to check for updates (in days)",
              "minimum": 1,
              "default": 7
            },
            "auto_update": {
              "type": "boolean",
              "description": "Whether to automatically update bake",
              "default": false
            },
            "prerelease": {
              "type": "boolean",
              "description": "Whether to include prereleases when checking for updates",
              "default": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "name": "my-project",
      "description": "Example project configuration",
      "variables": {
        "NODE_ENV": "production",
        "BUILD_DIR": "dist"
      },
      "environment": ["PATH", "HOME"],
      "config": {
        "maxParallel": 4,
        "fastFail": true,
        "verbose": false,
        "cache": {
          "local": {
            "enabled": true
          },
          "remotes": {
            "s3": {
              "bucket": "my-cache-bucket",
              "region": "us-east-1"
            }
          },
          "order": ["local", "s3"]
        },
        "update": {
          "enabled": true,
          "check_interval_days": 7
        }
      }
    }
  ]
}
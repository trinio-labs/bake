name: "foo"
environment:
  - TEST_COOKBOOK_VAR
variables:
  cookbook_name: "foo"
  foo: "build-bar"
  baz: bar
  env_var: test
  data_dir: "{{ var.cookbook_name }}/data"

overrides:
  dev:
    foo: dev_bar
    baz: dev_bar
  test:
    foo: bar
    baz: bar

recipes:
  post-test:
    description: "Post-test recipe for {{ var.cookbook_name }}"
    run: |
      echo "Hello Foo Post Test!"
    dependencies:
      - test

  build:
    description: "Build recipe using {{ var.foo }}"
    cache:
      inputs:
        - "build.sh" # relative path in same directory
        - "../*.txt" # parent directory pattern
        - "test/**/*" # subdirectory pattern
      outputs:
        - "target" # relative output
    run: |
      ./build.sh {{ var.foo }} {{ env.TEST_BAKE_VAR }} {{ project.root }}
    dependencies:
      - build-dep

  build-dep:
    description: "Build dependency for {{ var.cookbook_name }}"
    run: |
      echo "Hello Foo Build Dep!"

  test:
    description: "Test recipe for {{ var.cookbook_name }}"
    run: |
      echo "Hello Foo Test!"
    dependencies:
      - build
